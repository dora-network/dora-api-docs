# Getting started with the DORA API

## Introduction

The DORA platform provides a digital marketplace for trading fractionalized bonds opening a new era of financial inclusion.
The DORA API allows developers to interact with the platform programmatically, enabling them to build applications that can
trade, make markets, manage positions and analyse market data on the DORA platform.

## Authentication

TODO: describe how to authenticate with the DORA API, waiting for the dev team to provide details.

## Streaming APIs

DORA provides several websocket endpoints for real-time data streaming. These endpoints allow you to receive updates on
market data, user orders, transactions, and ledgers.

All streaming endpoints allow users to fetch historical data before receiving the real-time updates. This is useful for
cases where you want to start processing data from a specific point in time. For example, if you disconnected from DORA
for a while, you can fetch the data you missed when not connected, before subscribing to the real-time updates.

### Market Data

The following endpoints are available for market data streaming:

`GET /v1/orderbook/{orderbook_id}/open/stream?[since=YYYY-MM-DDTHH:mm:ssZZZ]` provides L3 order book updates for the given order book.

`GET /v1/charts/{orderbook_id}/candle/stream?[since=YYYY-MM-DDTHH:mm:ssZZZ]&[resolution=XX]` provides candlestick bars
for the chosen resolution (e.g., 1 minute, 5 minutes, etc.) for the given order book. If no resolution is specified,
the default is 1 minute.

`GET v1/trades/{orderbook_id}/stream?[since=YYYY-MM-DDTHH:mm:ssZZZ]` provides trades that have been executed on the given order book,
i.e. tick data for the order book. This includes information about the price, volume, and time of each trade.
This endpoint is useful for tracking the history of trades and understanding market activity.

`GET /v1/prices/stream?[since=YYYY-MM-DDTHH:mm:ssZZZ]` provides the latest price updates for all assets on the DORA platform.
This endpoint is useful for tracking the current price of assets and understanding market trends.

`GET /v1/orderbook/{orderbook_id}/balances/stream?[since=YYYY-MM-DDTHH:mm:ssZZZ]` provides updates on the balances of the base and
quote asset of the order book. The balances provide a view of the current liquidity available in the AMM pool associated with
the order book.

### User Specific Data

`GET /v1/user/{user_id}/orders/all/stream?[since=YYYY-MM-DDTHH:mm:ssZZZ]` provides updates on all orders placed by a specific user.
This endpoint allows you to track the status of orders, including when they are placed, filled, or cancelled.

`GET /v1/user/{user_id}/ledger/stream?[since=YYYY-MM-DDTHH:mm:ssZZZ]` provides updates on the user's ledger, which includes positions
and balances available for trading etc.

`GET /v1/user/{user_id}/transactions/stream?[since=YYYY-MM-DDTHH:mm:ssZZZ]` provides updates on the user's transactions, generated
on the DORA platform. This includes deposits, withdrawals, coupon payments, and other financial activities.

## Using the API

### User configuration

DORA provides limited support for updating user account data. The endpoint:

`PUT /v1/user/config/self` is a shortcut for updating your user avatar url, or timezone. Any other user data changes must be done
via the DORA web application or through the user interface provided by the platform.

To retrieve your user configuration data, you can use the endpoint:

`GET /v1/user/self`

### Assets

An asset is a tradable item on the DORA platform. It can be a currency, a bond, or other financial instrument. Each order book
is associated with two assets: a base asset and a quote asset. The base asset is the asset being traded, while the quote asset
is the currency or equivalent used to price the base asset.

A list of all available assets can be retrieved using the endpoint:

`GET /v1/assets`

If the asset is a bond, it will have additional bond specific information, such as the coupon rate, maturity date,
and other relevant details.

This endpoint also provides a filter allowing you to query for specific asset types, such as currencies or bonds, and
specific properties, such as assets created before or after a certain date.

To retrieve detailed information about a specific asset, you can use the endpoint:

`GET /v1/assets/{asset_id}`

The asset ID is a UUID v7 unique identifier that is automatically generated by the system when the asset is created.

#### Coupons

For assets that are bonds, you can retrieve information about the coupons associated with the bond using the endpoint:

`GET /v1/assets/{asset_id}/coupons`

### Order books

On DORA, each order book is a market for trading a specific pair of assets, such as a bond and a currency.
The order book is matched with an Automated Market Maker (AMM) pool, which provides liquidity for the order book.

Market orders are automatically executed against the AMM pool, while limit orders are added to the order book and
matched with other orders when the price conditions are met.

To retrieve a list of all order books available on the DORA platform, you can use the endpoint:

`GET /v1/orderbooks`

To filter the order books, you can use query parameters such as `base_asset_id` and `quote_asset_id` to filter by
specific asset pairs, or `status` to filter by the status of the order book (e.g., open, closed, suspended).

To retrieve detailed information about a specific order book, you can use the endpoint:

`GET /v1/orderbooks/{orderbook_id}`

The order book ID is a UUID v7 unique identifier that is automatically generated by the system when the order book
is created.

The API also provides 3 levels of market depth for order books:

- **Level 1 (L1)**: Best bid and ask prices, along with their respective volumes.
- **Level 2 (L2)**: Full order book with all bids and asks, including their prices and volumes.
- **Level 3 (L3)**: Full order book with individual orders, including their prices, volumes, and order IDs.

These can be accessed via the 

- `GET /v1/orderbook/{orderbook_id}/L1` 
- `GET /v1/orderbook/{orderbook_id}/L2` 
- `GET /v1/orderbook/{orderbook_id}/L3` 

endpoints. Additionally, you can subscribe to real-time updates for these levels via the streaming endpoints
as described in the "Streaming APIs" section.

A summary of the order book information can be retrieved using the endpoint:

`GET /v1/orderbooks/{orderbook_id}/summary` which provides a high-level overview of the order book,
including the best bid and ask prices, mid price and percentage spread.

### Orders

#### Submitting orders

To place an order on the DORA platform, you can use the endpoint:

`POST /v1/orders`

This endpoint allows you to submit a new order to the specified order book. The create order request looks like this:

```json
{
  "quantity": "100",  // number of units to buy/sell expressed as a string
  "inverse_leverage": 1.0, // the inverse leverage for the order, this is a decimal value between 0 and 1.0
  "price": "100.0", // required for limit orders, decimal value expressed as a string
  "kind": "limit", // the kind of order, can be "market" or "limit"
  "side": "buy", // the side of the order, can be "buy" or "sell"
  "order_book": "some-orderbook-id", // this must be a uuid v7 id of the order book you want to place the order on
  "user_text": "some user text", // optional user text to attach to the order, can be used for custom metadata
  "order_modifiers": [
    "MAX_BUY"
  ] // optional order modifiers, can be used to modify the behavior of the order. Currently MAX_BUY is the only supported modifier.
}
```

For market orders, the `price` field is not required and should be omitted. Setting the `MAX_BUY` modifier allows the order to be
executed at the best available price, up to the specified quantity, without exceeding the user's available balance.

#### Cancelling orders

You can cancel an open limit order using the endpoint:

`DELETE /v1/orders/{order_id}`

The order ID is a UUID v7 unique identifier that is automatically generated by the system when the order is created.
Market orders will be automatically executed against the AMM pool and cannot be cancelled once submitted.

You can also cancel all your open orders at once with the endpoint:

`DELETE /v1/orders`

This will use the `user_id` from the authentication token to identify the user and cancel all their open orders.

#### Updating orders

It is not possible to update an existing order on the DORA platform. If you need to change an order, you must cancel it
and then place a new order with the desired changes.

#### Querying orders

To retrieve a list of your orders, you can use the endpoint:

`GET /v1/orders`

This endpoint allows you to filter orders by various parameters, such as `status`, `order_book_id`, `kind`, and `side`.
You can also provide a date range using the `from` and `to` query parameters to filter orders by their creation date.
If only a `from` date is provided, the API will return all orders created after that date. If only a `to` date is provided,
the API will return all orders created before that date. If both dates are provided, the API will return all orders
created within the specified date range.

To retrieve detailed information about a specific order, you can use the endpoint:

`GET /v1/orders/{order_id}`

The order ID is a UUID v7 unique identifier automatically generated by the system when the order is created.

To receive updates on your orders in real-time, you can subscribe to the streaming endpoint:

`GET /v1/user/{user_id}/orders/all/stream?[since=YYYY-MM-DDTHH:mm:ssZZZ]`

This will allow you to receive updates on all your orders, including when they are placed, filled, or cancelled.
It is recommended to use the `since` parameter to specify a starting point for the updates, so you can
catch up on any missed updates since your last connection. Once connected, you will receive real-time updates
on your orders as you place them, and they are processed, filled, or cancelled.

### Ledgers

The DORA platform maintains a ledger for each user, which tracks their positions, balances, and other relevant information.
To retrieve your ledger, you can use the endpoint:

`GET /v1/ledger/positions/self`

Use your DORA user ID to retrieve your ledger. The user ID is a UUID v7 unique identifier that is automatically generated by
the system when your user account is created.

The position response looks like this:

```json
{
  "portfolio": {
    "user_id": "some-user-uuid",
    "positon": {
      "some-asset-uuid": {
        "some-position-uuid": {
          "id": "some-position-uuid",
          "asset_id": "some-asset-uuid",
          "seq": 1,
          "is_global": true,
          "available": "5000.0",
          "locked": "0.0",
          "supplied": "2000.0",
          "collateral": "0.0",
          "supplied_collateral": "0.0",
          "borrowed": "0.0",
          "impending_borrows": "0.0"
        },
        "some-other-position-uuid": {
          "id": "some-other-position-uuid",
          "asset_id": "some-other-asset-uuid",
          "seq": 2,
          "is_global": false,
          "available": "1000.0",
          "locked": "0.0",
          "supplied": "0.0",
          "collateral": "0.0",
          "supplied_collateral": "0.0",
          "borrowed": "0.0",
          "impending_borrows": "0.0"
        }
      },
      "some-other-asset-uuid": {
        ...
        // more positions for other assets
      },
      ... // more asset positions
    },
    "net_stablecoin_equivalence": {
      "gained": "1000.0", // the total amount of stablecoin equivalent gained
      "lost": "0" // the total amount of stablecoin equivalent lost
    }
  }
}
```

The `portfolio` object contains a map of asset IDs to their respective positions.
Each portfolio contains a single `global` position, which is a special position that represents the user's main account balance.
A position that is not flagged as `global` is an `isolated` position, which is similar to a sub-account or a specific trading
balance that has been created for a leveraged position.

To view just a list of all your global positions, you can use the endpoint:

`GET /v1/ledger/balances/self`

instead. You can also filter the positions by asset ID using the `asset_id` query parameter.

### Leverage operations

The DORA platform allows users to supply assets to a leverage pool, borrow assets from the pool, and perform other associated operations.
The leverage pool is a shared pool of assets that provides liquidity for leveraged trading, and is separate from the liquidity pool used for
the AMM order book.

To supply assets to the leverage pool, you can use the endpoint:

`POST /v1/leverage/supply`

This will transfer the specified amount of assets from your chosen position to the leverage pool, the balance will be reflected in your position,
and your available balance will be updated accordingly. The request body should look like this:

```json
{
  "position_id": "some-user-uuid", // the user ID of the user supplying the asset
  "asset_id": "some-asset-uuid", // the asset you want to supply
  "amount": "1000.0" // the amount of the asset to supply, expressed as a string
}
```

To withdraw assets from the leverage pool, you can use the endpoint:

`POST /v1/leverage/withdraw`

> TODO: Explain the borrowing and repaying operations, as well as the collateral and position isolation features.

### Reporting

DORA provides several endpoints for retrieving information for reporting and analysis purposes. In addition to the
orders API which allows you to retrieve historical information about your orders, you can also retrieve
information about the trades you have executed, and transactions that have occurred on the platform.

#### Trades

To get a list of trades that you have executed on the DORA platform, you can use the endpoint:

`GET /v1/trades`

> TODO: Describe the usage of this endpoint once the implementation has been completed.

#### Transactions

The DORA platform records all transactions, including orders, trades, and leverage operations.
To retrieve a list of transactions, you can use the endpoint:

`GET /v1/transactions`

This endpoint allows you to filter transactions by various parameters, such as `pools`, `user_ids`, `tx_kind`, and date ranges.

To retrieve information about a specific transaction, you can use the endpoint:

`GET /v1/transactions/{transaction_id}`

### Historical Data

DORA provides limited support for retrieving historical trade, order book, and candlestick data from the platform. In addition to the streaming endpoints
described earlier that allows you to fetch historical data before receiving real-time updates, you can also use the following endpoints:

- `GET /v1/trade?[pools=poolid1,poolid2,...]&[user_ids=user_id1,user_id2,...]&[tx_kind=kind1,kind2,...]&[from=YYYY-MM-DDTHH:mm:ssZZZ]&[to=YYYY-MM-DDTHH:mm:ssZZZ]`
- `GET /v1/charts/candle/{orderbook_id}/L3?[start=YYYY-MM-DDTHH:mm:ssZZZ]&[end=YYYY-MM-DDTHH:mm:ssZZZ]&[resolution=XX]`
